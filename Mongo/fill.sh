#!/bin/bash
wget -O - "https://storage.googleapis.com/gnomad-public/release/2.1.1/vcf/exomes/gnomad.exomes.r2.1.1.sites.Y.vcf.bgz" | gunzip -c | sed -n -e '/AF=/p' | sed -e 's/;/\t/g' | awk -F "\t" '{if(NR==1) system("mongo HAMMER --eval \"db.createCollection(\x27"$1"\x27)\"");for (i=8; i< 12; ++i) if(substr($i,1,3) == "AF=" && sprintf("%.3f", substr($i,4,length($i))) >= 0.01) system("mongo HAMMER --eval \"if (db."$1".find('"$1"',{_id:0}).count() > 0) {db."$1".insert({\"CHROM\":\x27"$1"\x27,\"POS\":"$2",\"REF\":\x27"$4"\x27,\"ALT\":\x27"$5"\x27,\"AF\":"substr($i,4,length($i))"})} else {}\"")}'